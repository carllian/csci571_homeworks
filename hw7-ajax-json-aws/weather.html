<html><head>
	<meta charset="utf-8">
  <title>HW8</title>
   
  <script src="http://yui.yahooapis.com/3.13.0/build/yui/yui-min.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.3.0/pure-min.css">
  <link rel="stylesheet" href="custom.css">
  
  <script language="javascript">

    $(document).ready(function() {
      $('#search-form').submit(function(event) {
        event.preventDefault(); // prevent page refresh
        
        // Check to make sure location was actually entered
        if((document.forms["search-form"]["location"].value=="") || (document.forms["search-form"]["location"].value==null)){ // check to make sure a location was entered
            window.alert("Please enter a location.");
            return false;
        }
        
        // Check to see if location is a valid city name
        var re = /^[A-Za-z]+,[ ]?[A-Za-z]{2,}(,[ ]?[A-Za-z]{2,})?$/;
        var match = re.exec(document.forms["search-form"]["location"].value);
        if (!match) { // the location isn't a city
          // Check to see if location is a valid zip code
          re = /^(?:\d{5})$/;
          var match = re.exec(document.forms["search-form"]["location"].value);
          if (!match) { // the location isn't a zip code either
            window.alert("If searching for a zip code, ensure the zip code is composed of 5 numbers. If searching for a city, ensure the city name is followed by a comma and a state or country.");
            return false;
          }
        }
        
        var url = "http://cs-server.usc.edu:65223/examples/servlet/weathersearch?location=Alameda,+CA&type=city&tempUnit=f";
        var jsonStr;
      
        $.ajax({
          type: 'GET',
          url: url, 
          success: function(response){
            alert(response);
            try {
              var jsonObject = JSON.parse(response);
            } catch(e){
               console.error("Parsing error:", e);
               alert("Invalid JSON string.");
            }
            alert(jsonObject.weather.link);
          }
        });
        
        
        
        YUI().use('node', function(Y) {
          var loadWeatherImage = function(e) {
            e.target.setHTML("<img src=\"http://l.yimg.com/a/i/us/we/52/26.gif\">");
            Y.one('#weather-image').addClass('image');
          }
          
          var node = Y.one('#weather-image');
        });
        
        YUI().use('datatable', function(Y) {
          var data = [
          {
          High: "68",
          Day: "Thu",
          "Weather": "Partly Cloudy",
          Low: "45"
          },
          {
          High: "64",
          Day: "Fri",
          Weather: "Sunny",
          Low: "44"
          },
          {
          High: "61",
          Day: "Sat",
          Weather: "Sunny",
          Low: "42"
          },
          {
          High: "63",
          Day: "Sun",
          Weather: "Partly Cloudy",
          Low: "41"
          },
          {
          High: "65",
          Day: "Mon",
          Weather: "Mostly Cloudy",
          Low: "44"
          }];
          var table = new Y.DataTable({
            columns: ["Day", "Weather", "High", "Low"],
            data: data
          });
          
          table.render("#forecast-table");
        });
        
        //alert("sent");
        return false;
        //loadXMLDoc(document.forms["search-form"]["location"].value);
        //return true;
      });
    });
    
    
  </script>
				
</head><body>
    <form class="pure-form" name="search-form" id="search-form">
      <span class="label">Location:</span><input class="input-large" type="text" name="location" placeholder="City name or zip code...">
      <input type="submit" class="pure-button" value="Search"><!-- onclick="validate()" Search</button>-->
    </form><br><br><br>
    <div class="pure-g">
      <div class="pure-u-1-3">
        <div id="weather-image"></div>
        <div id="temperature"></div>
        <div id="myDiv"></div>
      </div>
      <div class="pure-u-1-3">
        <h3>Forecast</h3>
        <div class="example yui3-skin-sam">
          <div id="forecast-table"></div>
        </div>
      </div>
      <div class="pure-u-1-3">
        facebook
      </div>
    </div>
    
</body></html>

